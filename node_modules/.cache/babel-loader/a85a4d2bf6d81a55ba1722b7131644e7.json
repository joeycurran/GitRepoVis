{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar subTypes = require('../scatter/subtypes');\n\nvar styleTextSelection = require('./edit_style').styleTextSelection;\n\nmodule.exports = function select(searchInfo, selectionTester) {\n  var cd = searchInfo.cd;\n  var selection = [];\n  var trace = cd[0].trace;\n  var stash = cd[0].t;\n  var len = trace._length;\n  var x = stash.x;\n  var y = stash.y;\n  var scene = stash._scene;\n  var index = stash.index;\n  if (!scene) return selection;\n  var hasText = subTypes.hasText(trace);\n  var hasMarkers = subTypes.hasMarkers(trace);\n  var hasOnlyLines = !hasMarkers && !hasText;\n  if (trace.visible !== true || hasOnlyLines) return selection;\n  var els = [];\n  var unels = []; // degenerate polygon does not enable selection\n  // filter out points by visible scatter ones\n\n  if (selectionTester !== false && !selectionTester.degenerate) {\n    for (var i = 0; i < len; i++) {\n      if (selectionTester.contains([stash.xpx[i], stash.ypx[i]], false, i, searchInfo)) {\n        els.push(i);\n        selection.push({\n          pointNumber: i,\n          x: x[i],\n          y: y[i]\n        });\n      } else {\n        unels.push(i);\n      }\n    }\n  }\n\n  if (hasMarkers) {\n    var scatter2d = scene.scatter2d;\n\n    if (!els.length && !unels.length) {\n      // reset to base styles when clearing\n      var baseOpts = new Array(scene.count);\n      baseOpts[index] = scene.markerOptions[index];\n      scatter2d.update.apply(scatter2d, baseOpts);\n    } else if (!scene.selectBatch[index].length && !scene.unselectBatch[index].length) {\n      // set unselected styles on 'context' canvas (if not done already)\n      var unselOpts = new Array(scene.count);\n      unselOpts[index] = scene.markerUnselectedOptions[index];\n      scatter2d.update.apply(scatter2d, unselOpts);\n    }\n  }\n\n  scene.selectBatch[index] = els;\n  scene.unselectBatch[index] = unels;\n\n  if (hasText) {\n    styleTextSelection(cd);\n  }\n\n  return selection;\n};","map":null,"metadata":{},"sourceType":"script"}