{"ast":null,"code":"/**\n* Copyright 2012-2019, Plotly, Inc.\n* All rights reserved.\n*\n* This source code is licensed under the MIT license found in the\n* LICENSE file in the root directory of this source tree.\n*/\n'use strict';\n\nvar Lib = require('../../lib');\n\nvar attributes = require('./attributes');\n\nvar handleDomainDefaults = require('../../plots/domain').defaults;\n\nvar handleText = require('../bar/defaults').handleText;\n\nmodule.exports = function supplyDefaults(traceIn, traceOut, defaultColor, layout) {\n  function coerce(attr, dflt) {\n    return Lib.coerce(traceIn, traceOut, attributes, attr, dflt);\n  }\n\n  var len;\n  var vals = coerce('values');\n  var hasVals = Lib.isArrayOrTypedArray(vals);\n  var labels = coerce('labels');\n\n  if (Array.isArray(labels)) {\n    len = labels.length;\n    if (hasVals) len = Math.min(len, vals.length);\n  } else if (hasVals) {\n    len = vals.length;\n    coerce('label0');\n    coerce('dlabel');\n  }\n\n  if (!len) {\n    traceOut.visible = false;\n    return;\n  }\n\n  traceOut._length = len;\n  var lineWidth = coerce('marker.line.width');\n  if (lineWidth) coerce('marker.line.color');\n  coerce('marker.colors');\n  coerce('scalegroup'); // TODO: hole needs to be coerced to the same value within a scaleegroup\n\n  var textData = coerce('text');\n  var textTemplate = coerce('texttemplate');\n  var textInfo;\n  if (!textTemplate) textInfo = coerce('textinfo', Array.isArray(textData) ? 'text+percent' : 'percent');\n  coerce('hovertext');\n  coerce('hovertemplate');\n\n  if (textTemplate || textInfo && textInfo !== 'none') {\n    var textposition = coerce('textposition');\n    handleText(traceIn, traceOut, layout, coerce, textposition, {\n      moduleHasSelected: false,\n      moduleHasUnselected: false,\n      moduleHasConstrain: false,\n      moduleHasCliponaxis: false,\n      moduleHasTextangle: false,\n      moduleHasInsideanchor: false\n    });\n    var hasBoth = Array.isArray(textposition) || textposition === 'auto';\n    var hasOutside = hasBoth || textposition === 'outside';\n\n    if (hasOutside) {\n      coerce('automargin');\n    }\n  }\n\n  handleDomainDefaults(traceOut, layout, coerce);\n  var hole = coerce('hole');\n  var title = coerce('title.text');\n\n  if (title) {\n    var titlePosition = coerce('title.position', hole ? 'middle center' : 'top center');\n    if (!hole && titlePosition === 'middle center') traceOut.title.position = 'top center';\n    Lib.coerceFont(coerce, 'title.font', layout.font);\n  }\n\n  coerce('sort');\n  coerce('direction');\n  coerce('rotation');\n  coerce('pull');\n};","map":null,"metadata":{},"sourceType":"script"}